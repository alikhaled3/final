(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2519],{42519:(e,t,a)=>{"use strict";a.d(t,{A:()=>q});var n=a(74848),s=a(96540),o=a(96048),i=a(11700),l=a(91106),r=a.n(l),c=a(97190),d=a(28165),h=a(29679),u=a(29335),m=a(39820),g=a(45904),p=a(86737),v=a.n(p),f=a(86715),x=a(10159),j=a(22405),S=a(24206),w=a(51630);function C(e){let{...t}=e,{imageTemplateUrlObj:a}=t,l=(0,o.d4)(e=>{var t,a,n,s;return null==e?void 0:null===(s=e.application)||void 0===s?void 0:null===(n=s.profile)||void 0===n?void 0:null===(a=n.profile)||void 0===a?void 0:null===(t=a.forms)||void 0===t?void 0:t.templatesList}),r=(0,o.d4)(e=>{var t,a;return null==e?void 0:null===(a=e.application)||void 0===a?void 0:null===(t=a.forms)||void 0===t?void 0:t.templatesList}),h=l||r,{profile:g,signedIn:p,user:C,app:y,fingerPrintProfile:b,storage:T}=(0,s.useContext)(u.t0),I=(0,o.wA)(),N=(0,f.useRouter)(),[k,E]=(0,s.useState)(null),[D,A]=(0,s.useState)([]),M=(0,j.aU)(y);(0,s.useEffect)(()=>{A(h&&Object.keys(h).sort((e,t)=>{let a=h[e].updatedAt,n=h[t].updatedAt;return a<n?1:a>n?-1:0}))},[h]),(0,s.useEffect)(()=>{(0,S.$)("View_FormsTemplates")},[]);let _=()=>{w.$Q(I,(0,n.jsxs)("p",{children:["Log in to your account to create a template",(0,n.jsx)("br",{})]}),"Login",()=>I((0,i.YW)("login")))},R=()=>{w.$Q(I,(0,n.jsxs)("p",{children:["Template creation is currently not available on mobile devices.",(0,n.jsx)("br",{}),"To create a template, please use a computer.",(0,n.jsx)("br",{}),"Mobile devices can still be used for form scanning."]}),"Got it",()=>{})},F=(e,t)=>{if(console.log("FormTemplates: templateSelected",k),e.stopPropagation(),x.Fr&&(!k||k!=t))E(t);else{let e=h[t];I((0,i.RQ)(e)),I((0,i.jQ)(d.ph)),N.push({pathname:c.IS,query:{templateId:t}})}},P=(e,t)=>{if(console.log("FormTemplates: editTemplate"),e.stopPropagation(),x.Fr&&(!k||k!=t))E(t);else{let e=h[t];I((0,i.RQ)(e)),I((0,i.jQ)(d.OW)),N.push(c.Uj)}},O=(e,t)=>{x.Fr&&(!k||k!=t)?E(t):p===m.iv?(0,u.oA)(C,M,t):(0,u.zl)(t,I)},U=(0,n.jsx)("div",{className:v().formListContainer,children:h&&D&&D.map(e=>{let t=h[e],s=null==t?void 0:t.templateName;return(a[e],t)?(0,n.jsxs)("div",{className:v().templateListItem,children:[(0,n.jsxs)("div",{className:[v().formTemplateListItem,x.Fr?v().showTemplateHoverMobile:""].join(" "),children:[(0,n.jsx)("div",{className:v().formTemplateThumbImage,onClick:t=>F(t,e),children:(0,n.jsx)("img",{src:a[e]})}),!x.Fr&&(0,n.jsxs)("div",{className:v().editTemplaeButtons,children:[(0,n.jsx)("button",{onClick:t=>P(t,e),children:(0,n.jsx)("img",{src:"/Images/edit_template.png"})}),(0,n.jsx)("button",{onClick:t=>O(t,e),children:(0,n.jsx)("img",{src:"/Images/delete_template.png"})})]}),(0,n.jsx)("img",{onClick:t=>F(t,e),className:v().StartNewBtn,src:"/Images/start_btn.png"})]}),(0,n.jsx)("p",{className:v().formTemplateName,children:s})]},e):(0,n.jsx)("div",{},e)})}),B=(0,n.jsxs)("div",{className:v().noAccountWarningImg,children:[(0,n.jsx)("img",{src:"/Images/info.png"}),(0,n.jsx)("p",{children:"Sign in or create a new account to save your templates"})]});return(0,n.jsxs)("div",{className:v().formsTemplatesMainView,children:[(0,n.jsxs)("div",{className:v().formTemplatesSection,children:[(0,n.jsxs)("div",{className:v().createNewTemplateTitle,children:[(0,n.jsx)("h4",{children:"Create a New Template "}),p===m.iv?(0,n.jsx)(n.Fragment,{}):B]}),(0,n.jsx)("div",{className:v().newTemplate,children:(0,n.jsx)("div",{className:v().formTemplateThumb,onClick:e=>{console.log("FormTemplates: newTemplatePressed"),e.stopPropagation(),p!==m.iv?_():x.Fr?R():(I((0,i.Qe)()),N.push(c.Uj),I((0,i.jQ)(d.iG)))},children:(0,n.jsx)("img",{className:v().NewTempalteStartNewBtn,src:"/Images/start_btn.png"})})})]}),h&&Object.keys(h).length>0&&(0,n.jsxs)("div",{className:v().formTemplatesSection,children:[(0,n.jsx)("h4",{children:"Start With an Existing Template"}),U]})]})}var y=a(51489),b=a(71998),T=a(29965),I=a.n(T);a(71301),a(14953);var N=a(95704),k=a(44526);function E(e){var t,l,r;let{...c}=e,h=(0,b.MW)(),m=(0,o.d4)(e=>e.application.forms.activeTemplate),[p,v]=(0,s.useState)(1),j=(0,o.wA)();(0,f.useRouter)();let{profile:w,user:C,storage:T}=(0,s.useContext)(u.t0),[E,D]=(0,s.useState)(!1),[A,M]=(0,s.useState)(null),[_,R]=(0,s.useState)(null),F=C&&C.uid;(0,s.useEffect)(()=>{(0,S.$)("View_FormTemplateSelect")},[]),(0,s.useEffect)(()=>{m&&m.image&&A&&(0,S.$)("Action_FileSet")},[m]);let P=(0,s.useCallback)(e=>{console.log("onDrop"),e.forEach(e=>{Q(e)})},[j]),{getRootProps:O,getInputProps:U,isDragActive:B}=(0,y.VB)({onDrop:P}),L=(e,t)=>h.info(e,t),W=async()=>{try{D(!0),L("Processing...",{timeout:0}),(0,S.$)("Action_FormTemplateConvertClicked"),console.log("preparing to load ");let e=await Promise.resolve().then(a.bind(a,27070));console.log("FormHelper ".concat(e)),z(A),e.sendTemplateForAnalyze(c.lak,A,F,m.scanId).then(e=>{j((0,i.RQ)({model:e})),j((0,i.jQ)(d.OW)),console.log("Finished processing"),h.removeAll()}).catch(e=>{console.log(e),h.removeAll(),h.error(e.message),D(!1)})}catch(e){D(!1),console.log(e),h.removeAll(),h.error(e.message)}},z=e=>{let t=(0,k.A)(),a=(0,g.KR)(T,"templateImages/"+t);console.log("Loading image:",a.fullPath);let n=function(e,t){for(var a=e.split(","),n=a[0].match(/:(.*?);/)[1],s=atob(a[1]),o=s.length,i=new Uint8Array(o);o--;)i[o]=s.charCodeAt(o);return new File([i],t,{type:n})}(e,m.image.name);(0,g.D)(a,n).then(e=>{console.log("Uploaded image",a.fullPath);let n=m.image;j((0,i.RQ)({image:{...n,uid:t}}))})},Q=e=>{let t=e.name;R(e),t.toLowerCase().endsWith(".pdf")?(0,N.getImageDimensions)(e).then(e=>{j((0,i.RQ)({image:{uid:void 0,width:e.width,height:e.height,name:t}}))}).catch(e=>{console.error("Error on image dimention extraction",e),h.error("Error reading image")}):(0,N.getImageDimensions)(e).then(a=>(0,N.resizeFile)(e,"base64").then(e=>{M(e),j((0,i.RQ)({image:{uid:void 0,width:a.width,height:a.height,name:t}}))})).catch(e=>{console.error("Error on image dimention extraction",e),h.error("Error reading image")})};m.image;let H=m.image&&null!=A?(0,n.jsxs)("div",{className:"loadingFileDiv",children:[(0,n.jsx)("div",{...O(),className:"working-space  ".concat(B?"":"noHover"),children:(0,n.jsxs)("div",{className:"file-tumbnail",children:[(null==m?void 0:null===(r=m.image)||void 0===r?void 0:null===(l=r.name)||void 0===l?void 0:null===(t=l.toLowerCase())||void 0===t?void 0:t.endsWith(".pdf"))?(0,n.jsx)("div",{className:"pdfThumb",children:(0,n.jsx)("img",{src:"/Images/PDF_thumbnail.png",alt:"images or pdf file tumbnail"})}):(0,n.jsx)("div",{className:"pdfThumb",children:(0,n.jsx)("img",{src:"/Images/image_thumbnail.png",alt:"images or pdf file tumbnail"})}),(0,n.jsx)("p",{children:m.image.name}),(0,n.jsx)("div",{className:"formTableActionButton",onClick:()=>{j((0,i.RQ)({image:null})),M(null)},children:(0,n.jsx)("img",{src:"/Images/delete_file.png",alt:"delete scan"})})]})}),(0,n.jsx)("div",{className:"convert-to",children:(0,n.jsxs)("button",{className:"convert-button",type:"button",disabled:E,onClick:W,children:["Continue ",(0,n.jsx)("img",{src:"/Images/Convert_btn_arrow.png",alt:"convert to text"})]})})]}):x.Fr?(0,n.jsx)("div",{...O(),className:"working-space ".concat(B?"":"noHover"),onClick:x.Fr?()=>{console.log("Fire camera view");let e=window.document.getElementById("input_file_obj");var t=document.createEvent("MouseEvent");t.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}:void 0,children:(0,n.jsxs)("button",{className:"start-btn noHover cursorActive",children:[(0,n.jsx)(I(),{width:70,height:70,className:"noHover",src:"/Images/start_btn.png",alt:"start button"}),(0,n.jsx)("p",{children:"Upload an image file to create a template"})]})}):(0,n.jsxs)("div",{...O(),className:"working-space ".concat(B?"":"noHover"),children:[(0,n.jsx)("input",{...U()}),(0,n.jsxs)("button",{className:"start-btn noHover cursorActive",type:"button",children:[(0,n.jsx)(I(),{width:70,height:70,className:"noHover",src:"/Images/start_btn.png",alt:"start button"}),(0,n.jsx)("p",{children:"Upload an image file to create a template"})]})]});return(0,n.jsxs)("main",{className:"fileSelectView",children:[x.Fr&&(0,n.jsx)("input",{type:"file",style:{display:"none"},id:"input_file_obj",onChange:()=>{console.log("mobile Image selected"),Q(window.document.getElementById("input_file_obj").files.item(0))}}),(0,n.jsx)("div",{className:"workingZone",children:H})]})}class D{get nodeWidth(){return this.shape.shapeStyle.transformerSize/this.scale}constructor(e,t){this.checkBoundary=(e,t)=>this.getCenterIndexByCursor(e,t)>=0,this.startTransformation=(e,t)=>{this.currentNodeCenterIndex=this.getCenterIndexByCursor(e,t)},this.onTransformation=(e,t)=>{this.getAllCentersTable()[this.currentNodeCenterIndex].adjust(e,t)},this.paint=(e,t,a)=>{this.scale=a;let n=this.getAllCentersTable();for(let a of(e.save(),e.fillStyle=this.shape.shapeStyle.transformerBackground,n)){let{x:n,y:s,width:o,height:i}=t({x:a.x-this.nodeWidth/2,y:a.y-this.nodeWidth/2,width:this.nodeWidth,height:this.nodeWidth});e.fillRect(n,s,o,i)}e.restore()},this.getCenterIndexByCursor=(e,t)=>this.getAllCentersTable().findIndex(a=>this.checkEachRectBoundary(a.x,a.y,e,t)),this.checkEachRectBoundary=(e,t,a,n)=>Math.abs(a-e)<=this.nodeWidth/2&&Math.abs(n-t)<=this.nodeWidth/2,this.getAllCentersTable=()=>{let{shape:e}=this,{x:t,y:a,width:n,height:s}=e.getAnnotationData().mark;return[{x:t,y:a,adjust:(o,i)=>{e.adjustMark({x:o,y:i,width:n+t-o,height:s+a-i})}},{x:t+n/2,y:a,adjust:(t,n)=>{e.adjustMark({y:n,height:s+a-n})}},{x:t+n,y:a,adjust:(n,o)=>{e.adjustMark({x:t,y:o,width:n-t,height:a+s-o})}},{x:t,y:a+s/2,adjust:a=>{e.adjustMark({x:a,width:n+t-a})}},{x:t+n,y:a+s/2,adjust:a=>{e.adjustMark({width:a-t})}},{x:t,y:a+s,adjust:(s,o)=>{e.adjustMark({x:s,width:n+t-s,height:o-a})}},{x:t+n/2,y:a+s,adjust:(t,n)=>{e.adjustMark({height:n-a})}},{x:t+n,y:a+s,adjust:(n,s)=>{e.adjustMark({width:n-t,height:s-a})}}]},this.shape=e,this.scale=t}}class A{constructor(e){this.onMouseDown=()=>void 0,this.onMouseMove=(e,t)=>{let{shapes:a}=this.context;a[a.length-1].onDrag(e,t)},this.onMouseUp=()=>{let{setAnnotationState:e}=this.context;e(new _(this.context))},this.onMouseLeave=()=>this.onMouseUp(),this.context=e}}class M{constructor(e){this.onMouseDown=()=>void 0,this.onMouseMove=(e,t)=>{let{currentTransformer:a}=this.context;a&&a.onTransformation(e,t)},this.onMouseUp=()=>{let{setAnnotationState:e}=this.context;e(new _(this.context))},this.onMouseLeave=()=>this.onMouseUp(),this.context=e}}class _{constructor(e){this.onMouseMove=()=>void 0,this.onMouseUp=()=>void 0,this.onMouseLeave=()=>void 0,this.onMouseDown=(e,t)=>{let{shapes:a,currentTransformer:n,onShapeChange:s,setAnnotationState:o}=this.context;if(n&&n.checkBoundary(e,t)){n.startTransformation(e,t),o(new M(this.context));return}for(let n=a.length-1;n>=0;n--)if(a[n].checkBoundary(e,t)){this.context.selectedId=a[n].getAnnotationData().id,this.context.currentTransformer=new D(a[n],this.context.scaleState.scale);let[i]=a.splice(n,1);a.push(i),i.onDragStart(e,t),s(),o(new A(this.context));return}},this.context=e}}let R=()=>(0,n.jsx)("svg",{className:"rpDelete",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,n.jsx)("g",{"data-name":"Layer 2",children:(0,n.jsxs)("g",{"data-name":"trash-2",children:[(0,n.jsx)("rect",{width:"24",height:"24",opacity:"0"}),(0,n.jsx)("path",{d:"M21 6h-5V4.33A2.42 2.42 0 0 0 13.5 2h-3A2.42 2.42 0 0 0 8 4.33V6H3a1 1 0 0 0 0 2h1v11a3 3 0 0 0 3 3h10a3 3 0 0 0 3-3V8h1a1 1 0 0 0 0-2zM10 16a1 1 0 0 1-2 0v-4a1 1 0 0 1 2 0zm0-11.67c0-.16.21-.33.5-.33h3c.29 0 .5.17.5.33V6h-4zM16 16a1 1 0 0 1-2 0v-4a1 1 0 0 1 2 0z"})]})})}),F=e=>{let{value:t,onChange:a,onDelete:s,placeholder:o="INPUT TAG HERE"}=e;return(0,n.jsxs)("div",{className:"rpDefaultInputSection",children:[(0,n.jsx)("input",{className:"rpDefaultInputSection_input",placeholder:o,value:t,onChange:e=>a(e.target.value)}),(0,n.jsx)("a",{className:"rpDefaultInputSection_delete",onClick:()=>s(),children:(0,n.jsx)(R,{})})]})};var P=a(23839),O=a.n(P);let U={padding:5,lineWidth:2,shadowBlur:10,fontSize:12,fontColor:"#246deb",fontBackground:"#246deb",fontFamily:"-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen-Sans, Ubuntu, Cantarell, 'Helvetica Neue', Helvetica, Arial, sans-serif",shapeBackground:"hsla(210, 16%, 93%, 0.35)",shapeStrokeStyle:"#246deb",shapeShadowStyle:"hsla(210, 9%, 31%, 0)",transformerBackground:"#246deb",transformerSize:6,selectedStrokeStyle:"#246deb",selectedLineWidth:2};class B{constructor(e,t,a=U){this.onDragStart=(e,t)=>{let{x:a,y:n}=this.annotationData.mark;this.dragStartOffset={offsetX:e-a,offsetY:t-n}},this.onDrag=(e,t)=>{this.annotationData.mark.x=e-this.dragStartOffset.offsetX,this.annotationData.mark.y=t-this.dragStartOffset.offsetY,this.onChangeCallBack()},this.checkBoundary=(e,t)=>{let{mark:{x:a,y:n,width:s,height:o}}=this.annotationData;return(e>a&&e<a+s||e<a&&e>a+s)&&(t>n&&t<n+o||t<n&&t>n+o)},this.paint=(e,t,a)=>{let{x:n,y:s,width:o,height:i}=t(this.annotationData.mark);e.save();let{padding:l,lineWidth:r,shadowBlur:c,fontSize:d,fontColor:h,fontBackground:u,fontFamily:m,shapeBackground:g,shapeStrokeStyle:p,shapeShadowStyle:v,selectedStrokeStyle:f,selectedLineWidth:x}=this.shapeStyle;if(e.shadowBlur=c,e.shadowColor=v,e.strokeStyle=a?f:p,e.lineWidth=a?x:r,e.strokeRect(n,s,o,i),e.restore(),a)e.fillStyle=g,e.fillRect(n,s,o,i);else{let{comment:t}=this.annotationData;if(t){e.font="".concat(d,"px ").concat(m);let a=e.measureText(t);e.save(),e.fillStyle=u,e.fillRect(n,s,a.width+2*l,d+2*l),e.textBaseline="top",e.fillStyle=h,e.fillText(t,n+l,s+l)}}return e.restore(),{x:n,y:s,width:o,height:i}},this.adjustMark=e=>{let{x:t=this.annotationData.mark.x,y:a=this.annotationData.mark.y,width:n=this.annotationData.mark.width,height:s=this.annotationData.mark.height}=e;this.annotationData.mark.x=t,this.annotationData.mark.y=a,this.annotationData.mark.width=n,this.annotationData.mark.height=s,this.onChangeCallBack()},this.getAnnotationData=()=>this.annotationData,this.setComment=e=>{this.annotationData.comment=e},this.equal=e=>e.id===this.annotationData.id&&e.comment===this.annotationData.comment&&e.mark.x===this.annotationData.mark.x&&e.mark.y===this.annotationData.mark.y&&e.mark.width===this.annotationData.mark.width&&e.mark.height===this.annotationData.mark.height,this.annotationData=e,this.onChangeCallBack=t,this.shapeStyle=a}}let L={scale:1,originX:0,originY:0};class W extends s.Component{set selectedId(e){let{onSelect:t}=this.props;this.selectedIdTrueValue=e,t(e)}get selectedId(){return this.selectedIdTrueValue}get annotationStyle(){return this.props.annotationStyle}get defaultAnnotationSize(){return this.props.defaultAnnotationSize}render(){let{width:e,height:t,inputElement:a,editable:s}=this.props,{showInput:o,inputPosition:i,inputComment:l}=this.state;return(0,n.jsxs)("div",{className:O().rpStage,children:[(0,n.jsx)("canvas",{style:{width:e,height:t},className:O().rpImage,ref:this.imageCanvasRef,width:2*e,height:2*t}),(0,n.jsx)("canvas",{className:O().rpShapes,style:{width:e,height:t},ref:this.canvasRef,width:2*e,height:2*t,onMouseDown:s?this.onMouseDown:()=>{},onMouseMove:s?this.onMouseMove:()=>{},onMouseUp:s?this.onMouseUp:()=>{},onMouseLeave:s?this.onMouseLeave:()=>{}}),o&&(0,n.jsx)("div",{className:O().rpSelectedInput,style:i,children:a(l,this.onInputCommentChange,this.onDelete)})]})}constructor(...e){super(...e),this.state={inputPosition:{left:0,top:0},showInput:!1,inputComment:""},this.shapes=[],this.scaleState=L,this.currentAnnotationData=[],this.canvasRef=s.createRef(),this.imageCanvasRef=s.createRef(),this.currentAnnotationState=new _(this),this.componentDidMount=()=>{let e=this.canvasRef.current,t=this.imageCanvasRef.current;e&&t&&(this.setCanvasDPI(),this.canvas2D=e.getContext("2d"),this.imageCanvas2D=t.getContext("2d"),this.onImageChange()),this.syncAnnotationData(),this.syncSelectedId()},this.componentDidUpdate=e=>{let{width:t,height:a,image:n}=this.props;(e.width!==t||e.height!==a)&&(this.setCanvasDPI(),this.onShapeChange(),this.onImageChange()),e.image!==n&&(this.cleanImage(),this.currentImageElement?this.currentImageElement.src=n:this.onImageChange()),this.syncAnnotationData(),this.syncSelectedId()},this.calculateMousePosition=(e,t)=>{let{originX:a,originY:n,scale:s}=this.scaleState;return{positionX:(e-a)/s,positionY:(t-n)/s}},this.calculateShapePosition=e=>{let{originX:t,originY:a,scale:n}=this.scaleState,{x:s,y:o,width:i,height:l}=e;return{x:s*n+t,y:o*n+a,width:i*n,height:l*n}},this.setAnnotationState=e=>{this.currentAnnotationState=e},this.onShapeChange=()=>{if(this.canvas2D&&this.canvasRef.current){this.canvas2D.clearRect(0,0,this.canvasRef.current.width,this.canvasRef.current.height);let e=!1;for(let t of this.shapes){let a=t.getAnnotationData().id===this.selectedId,{x:n,y:s,height:o}=t.paint(this.canvas2D,this.calculateShapePosition,a);a&&(this.currentTransformer||(this.currentTransformer=new D(t,this.scaleState.scale)),e=!0,this.currentTransformer.paint(this.canvas2D,this.calculateShapePosition,this.scaleState.scale),this.setState({showInput:!0,inputPosition:{left:n,top:s+o+this.props.marginWithInput},inputComment:t.getAnnotationData().comment||""}))}e||this.setState({showInput:!1,inputComment:""})}this.currentAnnotationData=this.shapes.map(e=>e.getAnnotationData());let{onChange:e}=this.props;e(this.currentAnnotationData)},this.syncAnnotationData=()=>{let{annotationData:e}=this.props;if(e){let t=()=>{this.selectedId=null,this.shapes=e.map(e=>new B(e,this.onShapeChange,this.annotationStyle)),this.onShapeChange()};if(e.length!==this.shapes.length)t();else for(let a of e){let e=this.shapes.find(e=>e.getAnnotationData().id===a.id);if(!(e&&e.equal(a))){t();break}}}},this.syncSelectedId=e=>{let{selectedId:t}=e?{selectedId:e}:this.props;t&&t!==this.selectedId&&(this.selectedId=t,this.currentTransformer=null,this.onShapeChange())},this.onDelete=()=>{let e=this.shapes.findIndex(e=>e.getAnnotationData().id===this.selectedId);e>=0&&(this.shapes.splice(e,1),this.onShapeChange())},this.setCanvasDPI=()=>{let e=this.canvasRef.current,t=this.imageCanvasRef.current;if(e&&t){let a=e.getContext("2d"),n=t.getContext("2d");a&&n&&(a.scale(2,2),n.scale(2,2))}},this.onInputCommentChange=e=>{let t=this.shapes.findIndex(e=>e.getAnnotationData().id===this.selectedId);this.shapes[t].setComment(e),this.setState({inputComment:e})},this.cleanImage=()=>{this.imageCanvas2D&&this.imageCanvasRef.current&&this.imageCanvas2D.clearRect(0,0,this.imageCanvasRef.current.width,this.imageCanvasRef.current.height)},this.onImageChange=()=>{if(this.cleanImage(),this.imageCanvas2D&&this.imageCanvasRef.current){if(this.currentImageElement){let{originX:e,originY:t,scale:a}=this.scaleState;this.imageCanvas2D.drawImage(this.currentImageElement,e,t,this.currentImageElement.width*a,this.currentImageElement.height*a)}else{let e=document.createElement("img");e.addEventListener("load",()=>{this.currentImageElement=e;let{width:t,height:a}=e,n=a/t,{width:s,height:o}=this.props,i=o/s;if(!isNaN(n)&&!isNaN(i)){if(n<i){let e=s/t;this.scaleState={originX:0,originY:(o-e*a)/2,scale:e}}else{let e=o/a;this.scaleState={originX:(s-e*t)/2,originY:0,scale:e}}}this.onImageChange(),this.onShapeChange()}),e.alt="",e.src=this.props.image}}},this.onMouseDown=e=>{let{offsetX:t,offsetY:a}=e.nativeEvent,{positionX:n,positionY:s}=this.calculateMousePosition(t,a);this.currentAnnotationState.onMouseDown(n,s)},this.onMouseMove=e=>{let{offsetX:t,offsetY:a}=e.nativeEvent,{positionX:n,positionY:s}=this.calculateMousePosition(t,a);this.currentAnnotationState.onMouseMove(n,s)},this.onMouseUp=()=>{this.currentAnnotationState.onMouseUp()},this.onMouseLeave=()=>{this.currentAnnotationState.onMouseLeave()},this.onWheel=e=>{let{clientHeight:t,scrollTop:a,scrollHeight:n}=e.currentTarget;t+a+e.deltaY>n?e.currentTarget.scrollTop=n:a+e.deltaY<0&&(e.currentTarget.scrollTop=0);let{scale:s}=this.scaleState;this.scaleState.scale+=e.deltaY*this.props.scrollSpeed,this.scaleState.scale>10&&(this.scaleState.scale=10),this.scaleState.scale<.1&&(this.scaleState.scale=.1);let{originX:o,originY:i,scale:l}=this.scaleState,{offsetX:r,offsetY:c}=e.nativeEvent;this.scaleState.originX=r-(r-o)/s*l,this.scaleState.originY=c-(c-i)/s*l,this.setState({imageScale:this.scaleState}),requestAnimationFrame(()=>{this.onShapeChange(),this.onImageChange()})}}}W.defaultProps={marginWithInput:10,scrollSpeed:5e-4,editable:!0,annotationStyle:U,inputElement:(e,t,a)=>(0,n.jsx)(F,{value:e,onChange:t,onDelete:a})};var z=a(15901);let Q=(0,s.forwardRef)((e,t)=>{let{templateMode:a,tableModel:o,setTableModel:i,annotationModel:l,setAnnotationModel:r,image:c,imageContent:d,pageSize:h,setPageSize:u,multiPage:m}=e,[g,p]=(0,s.useState)(null),f=(0,s.useRef)(),[x,j]=(0,s.useState)(null),[S,w]=(0,s.useState)(null),[C,y]=(0,s.useState)(!1),b=null==c?void 0:c.width,T=null==c?void 0:c.height,I=(0,s.useRef)(null);(0,s.useEffect)(()=>(window.addEventListener("resize",R),y(!0),o.length>0&&(console.log("Defaulting to first block",o[0].id),j(o[0].id)),()=>{window.removeEventListener("resize",R),I.current=null}),[]),(0,s.useEffect)(()=>{I&&I.current&&(console.log("Focus on input",I.current),I.current.focus())},[I.current,I]);let N=()=>{p(Object.values(l).map(e=>{let t={x:e.box.x,y:e.box.y,width:e.box.w,height:e.box.h,type:"RECT"};return{...e,mark:t}}))};(0,s.useEffect)(()=>{x&&(a||null!=g)||N()},[l]),(0,s.useEffect)(()=>{r({...l})},[C]);let k=(e,t)=>{let a=[...o],n={...o[e]};n.keyName=t,a[e]=n,i(a),!1==Object.keys(l).includes(n.id)&&(console.log("Updating annotation model due to missing:",n.id),O())},E=(e,t)=>{let a=[...o],n={...o[e]};n.value=t,a[e]=n,i(a)},D=e=>{console.log("Deleting block",e),j(null);let t=o[e],a=[...o];a.splice(e,1),i(a);let n={...l};delete n[t.id],r(n)},A=e=>{var t,a,n,s,i;let l=o[e];console.log("tableCellSelected",e,l.id),null===(t=f.current)||void 0===t||t.syncSelectedId(l.id);let r=null===(i=f.current)||void 0===i?void 0:null===(s=i.currentTransformer)||void 0===s?void 0:null===(n=s.getAllCentersTable())||void 0===n?void 0:null===(a=n.at(0))||void 0===a?void 0:a.y,c=r?r/T*h.height-30:void 0;r&&document.getElementById("formReviewImage").scrollTo(0,c)},M=e=>{console.log("preventAction",e),e.preventDefault()};(0,s.useImperativeHandle)(t,()=>({setSelectedCell(e){let t=o.findIndex(t=>t.id===e);console.log("setSelectedCell",e,t),w(e),j(e)},deselectCell(){console.log("Deslecting cell"),j(null),p(null),w(null)}}));let _=o.length>0?(0,n.jsx)(z.ReactSortable,{list:o,setList:i,disabled:!a,delay:200,delayOnTouchOnly:!0,children:o.map((e,t)=>{let s=e.id===x;return s&&setTimeout(()=>{var e;null==I||null===(e=I.current)||void 0===e||e.focus()},500),(0,n.jsxs)("div",{className:v().formTableLine,children:[a&&(0,n.jsx)("div",{className:v().formTableActionButton,children:(0,n.jsx)("img",{src:"/Images/move_field.png"})}),a?s?(0,n.jsx)("input",{ref:I,className:v().formTableKeyInput,onSelect:e=>A(t),value:e.keyName,onChange:e=>k(t,e.target.value),autoFocus:!0}):(0,n.jsx)("input",{className:v().formTableKeyInput,onSelect:e=>A(t),value:e.keyName,onChange:e=>k(t,e.target.value)}):(0,n.jsx)("label",{className:v().formTableKeyLabel,children:e.keyName}),a?(0,n.jsx)("label",{className:v().formTableValueLabel,children:e.value}):s?(0,n.jsx)("input",{ref:I,onCopy:M,onCut:M,className:v().formTableValueInput,value:e.value,onSelect:e=>A(t),onChange:e=>E(t,e.target.value),autoFocus:!0}):(0,n.jsx)("input",{onCopy:M,onCut:M,className:v().formTableValueInput,value:e.value,onSelect:e=>A(t),onChange:e=>E(t,e.target.value)}),a&&(0,n.jsx)("div",{className:v().formTableActionButton,onClick:()=>D(t),children:(0,n.jsx)("img",{src:"/Images/delete_field.png"})})]},e.id)})}):(0,n.jsx)(n.Fragment,{}),R=()=>{console.log("Page resized"),u({width:window.innerWidth,height:window.innerHeight}),y(!1),setTimeout(()=>{N(),y(!0)},100)},F=e=>{let t={...e};return t.w=t.width,t.h=t.height,delete t.width,delete t.height,t},P=e=>e.reduce((e,t)=>{let a={...t.mark};a.w=a.width,a.h=a.height;let n={...t};return n.box=a,{...e,[t.id]:n}},{}),O=()=>{let e=f.current?f.current.currentAnnotationData:[],t={...l};try{null==e||e.forEach(e=>{let a=e.id,n=F(e.mark);t[a]={...t[a],id:a,box:n}})}catch(t){console.error("Error on updateModelBlocksFromAnnotation",t),console.error(e)}f.current&&r(t)},B=o.length>0?o.map(e=>e.id):[],L=e=>{console.log("syncAnnotationModelWithTablemodel");let t=P(e);t&&Object.keys(t).forEach(t=>{if(!1===B.includes(t)){console.log("Adding new block |".concat(t,"|").concat(t in B,"|").concat(B,"|"));let a=[...o],n={keyName:"Cell ".concat(o.length),value:"",order:o.length,id:t};a.push(n),i(a);let s={...l},r=e.pop();s[t]={id:t,box:F(r.mark)},console.log("Setting new block",t,s[t])}})},Q=h.height<h.width?h.width:6*h.height/4,H=a?6:0,Y=a?"#246deb":"#2067d8",X=a?2:3;return(0,n.jsxs)("div",{className:[v().formReviewMain,m?v().alignMultiPage:void 0].join(" "),children:[(0,n.jsx)("div",{id:"formReviewImage",className:v().formReviewImage,children:C&&d&&(0,n.jsx)(W,{ref:f,image:d,onSelect:e=>{console.log("Selected annotation ID:".concat(e)),j(e),p(null),w(null),e||(I.current=null)},onChange:e=>{console.log("onChange"),p(null),a&&(x?O():L(e))},width:Q/.75/4,height:T/b*Q/.75/4,annotationData:g,annotationStyle:{...U,shapeStrokeStyle:"#2193ff",transformerBackground:"#246deb",transformerSize:H,selectedStrokeStyle:Y,selectedLineWidth:X},selectedId:S,scrollSpeed:0,inputElement:(e,t,a)=>(0,n.jsx)(n.Fragment,{}),editable:a})}),(0,n.jsx)("div",{className:v().formReviewTable,onContextMenu:e=>e.preventDefault(),children:_})]})}),H=e=>{let{...t}=e,a=(0,o.d4)(e=>e.application.forms.activeTemplate),[l,r]=(0,s.useState)(a.templateName||""),[c,h]=(0,s.useState)([]),[g,p]=(0,s.useState)({}),f=(0,s.useRef)(),[x,S]=(0,s.useState)({width:window.innerWidth,height:window.innerHeight}),[w,C]=(0,s.useState)(a.image),{profile:y,user:b,db:T,storage:I,signedIn:N}=(0,s.useContext)(u.t0),[E,D]=(0,s.useState)(null),A=(0,j.aU)(),M=(0,o.wA)();(0,s.useEffect)(()=>{if(a){console.log("Active template changed",a);let e=null==t?void 0:t.imageTemplateUrlObj[a.scanId];console.log("Image content url:",e),D(e),C(a.image);let n=[],s={};Object.keys(a.model.blocks).forEach((e,t)=>{let o={...a.model.blocks[e]};delete o.box,n.push(o);let i={...a.model.blocks[e]};delete i.keyName,delete i.value,delete i.order,s[e]=i}),n.sort((e,t)=>e.order-t.order),h(n),p(s),setTimeout(()=>{var e;null===(e=f.current)||void 0===e||e.setSelectedCell(n[0].id)},500)}},[a,null==t?void 0:t.imageTemplateUrlObj]);let _=()=>{let e={...a.model},t={};return c.forEach((e,a)=>{t[e.id]={...e,...g[e.id],order:a}}),e.blocks=t,e},R=e=>{var t;null===(t=f.current)||void 0===t||t.deselectCell(),r(e)};return(0,n.jsxs)("div",{className:v().FormTemplateEditor,children:[(0,n.jsx)("div",{className:v().FormEditorHeaderContainer,children:(0,n.jsxs)("div",{className:v().formEditorHeader,children:[(0,n.jsxs)("div",{className:v().templateEditorSave,children:[(0,n.jsx)("input",{placeholder:"Template Name",value:l,onChange:e=>{R(e.target.value)}}),(0,n.jsx)("button",{onClick:()=>{let e=_();M((0,i.RQ)({model:e,templateName:l})),M((0,i.jQ)(d.d3));let t={...a,model:e,templateName:l};N===m.iv?(0,u.v5)(b,A,t):(0,u.Jh)(t,M),M((0,i.Qe)())},children:"Save Template"})]}),(0,n.jsx)("div",{className:v().templateEditorButtons,children:(0,n.jsx)("div",{className:v().addNewFieldButton,onClick:()=>{var e;console.log("add new field pressed");let t=_(),n=(0,k.A)().substring(0,6).toUpperCase(),s=.3*a.image.width,o=30/x.height*a.image.height,l=50/x.width*a.image.width,r=.05*a.image.height,d={order:c.length,id:n,keyName:"Cell ".concat(c.length),value:"",box:{x:l,y:r,w:s,h:o}};t.blocks[n]=d,console.log("Adding new block:",d),null===(e=f.current)||void 0===e||e.deselectCell(),M((0,i.RQ)({model:t})),setTimeout(()=>{var e;null===(e=f.current)||void 0===e||e.setSelectedCell(n)},1e3)},children:(0,n.jsx)("img",{src:"/Images/add_new_field.png"})})})]})}),(0,n.jsx)("div",{className:v().templateEditorBody,children:(0,n.jsx)(Q,{ref:f,pageSize:x,setPageSize:S,templateMode:!0,image:w,imageContent:E,tableModel:c,setTableModel:h,annotationModel:g,setAnnotationModel:p,multiPage:!1})})]})};var Y=a(83953),X=a(27070);function V(e){let{activeScans:t,setActiveScans:a,...l}=e,r=(0,b.MW)(),c=(0,o.wA)(),h=(0,f.useRouter)().query.templateId,{user:m}=(0,s.useContext)(u.t0),g=(0,o.d4)(e=>e.application.forms.activeTemplate),p=(0,o.d4)(e=>{var t,a,n,s;return null==e?void 0:null===(s=e.application)||void 0===s?void 0:null===(n=s.profile)||void 0===n?void 0:null===(a=n.profile)||void 0===a?void 0:null===(t=a.forms)||void 0===t?void 0:t.templatesList}),v=(0,s.useRef)({}),j=(0,s.useRef)(null);(0,s.useEffect)(()=>{(0,S.$)("View_FormScanSelect")},[]),(0,s.useEffect)(()=>{if(console.log("TemplateId",h,"activeTemplate is undefined:",void 0===g),h&&void 0===g&&void 0!==p){console.log("Setting active template");let e=p[h];c((0,i.RQ)(e))}},[h,p]);let w=async(e,t)=>e.type.toLowerCase().toLowerCase().endsWith("pdf")?((0,S.$)("State_pdfFile"),console.log("Splitting pdf"),X.splitPdfAndAnalyze(l.lak,t.content,g,m,t.id)):((0,S.$)("State_imageFile"),console.log("Sending image"),X.sendScanForAnalyze(l.lak,t.content,g,m,t.id));return(0,n.jsxs)("main",{className:"fileSelectView",children:[x.Fr&&(0,n.jsx)("input",{ref:j,type:"file",style:{display:"none"},id:"input_file_obj",onChange:e=>{var t;null==v||null===(t=v.current)||void 0===t||t.onMobileFileChange(e.target.value)}}),(0,n.jsx)(Y.e,{showInfoMsg:(e,t)=>r.info(e,t),onAnalyzePage:(e,t,a)=>{let n={...e};if(n.id="".concat(e.id,"_").concat(a),n.result=t.result,n.scale=t.scale,n.service="FORMS",void 0===n.width&&(n.width=t.width,n.height=t.height),e.name.toLowerCase().endsWith(".pdf")){let e="data:image/jpeg;base64,".concat(t.imgContent);n.content=e}return n},onAnalysisComplete:e=>{a(e.reduce((e,t)=>({...e,[t.id]:t}),{})),c((0,i.jQ)(d.QF))},preProcessFile:(e,t)=>!0,alert:r,processFileBlob:w,fileSelectMobileDiv:j,fileSelectRef:v})]})}let $=e=>{let{...t}=e,a=t.activeScans,i=t.setActiveScans,l=a?Object.keys(a).length:0,[r,g]=(0,s.useState)(0),[p,x]=(0,s.useState)({}),[C,y]=(0,s.useState)({}),[T,I]=(0,s.useState)({}),[k,E]=(0,s.useState)(N.EXPORT_TYPE.DOCUMENT),[D,A]=(0,s.useState)("word"),[M,_]=(0,s.useState)("excel"),{profile:R,signedIn:F,user:P,app:O,fingerPrintProfile:U}=(0,s.useContext)(u.t0),B=(0,b.MW)(),L=(0,s.useRef)(),[W,z]=(0,s.useState)({width:window.innerWidth,height:window.innerHeight}),[H,Y]=(0,s.useState)(!1),X=(0,j.aU)(O),V=(0,f.useRouter)(),$=Object.keys(a),q=(0,o.wA)();(0,s.useEffect)(()=>{if(a){let e=Object.values(a)[r],t=null==e?void 0:e.result,n=[],s={};t&&Object.keys(t).forEach(e=>{let a={...t[e]};delete a.box,n.push(a);let o={...t[e]};delete o.keyName,delete o.value,delete o.order,s[e]=o}),n.sort((e,t)=>e.order-t.order),x(n),y(s),I(e),setTimeout(()=>{var e;null===(e=L.current)||void 0===e||e.setSelectedCell(n[0].id)},500),Y(!0)}},[a,r]);let K=()=>{let e={};p.forEach((t,a)=>{e[t.id]={...t,...C[t.id],order:a}});let t={...a,[T.id]:{...a[T.id],result:e}};return i(e=>t),t},G=e=>{Y(!1),K(),g(e)};return(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:v().FormEditorHeaderContainer,children:(0,n.jsx)("div",{className:v().formEditorHeader,children:(0,n.jsxs)("div",{className:v().makeRow,children:[(0,n.jsxs)("div",{className:v().exportTypeContainer,children:[(0,n.jsxs)("div",{className:[v().exportType,k===N.EXPORT_TYPE.DOCUMENT&&v().exportTypeSelected].join(" "),children:[(0,n.jsxs)("div",{className:v().exportTypeButton,onClick:()=>{E(N.EXPORT_TYPE.DOCUMENT)},children:[(0,n.jsx)("img",{src:k===N.EXPORT_TYPE.DOCUMENT?"/Images/document_icon_selected.png":"/Images/document_icon.png",alt:"word"}),(0,n.jsx)("p",{children:"Doc"})]}),(0,n.jsxs)("select",{value:D,name:"documentExportFormat",onChange:e=>A(e.target.value),children:[(0,n.jsx)("option",{value:"word",children:"WORD"}),(0,n.jsx)("option",{value:"text",children:"TEXT"}),(0,n.jsx)("option",{value:"clipboard",children:"CLIPBOARD"})]})]}),(0,n.jsxs)("div",{className:[v().exportType,k===N.EXPORT_TYPE.SHEET&&v().exportTypeSelected].join(" "),children:[(0,n.jsxs)("div",{className:v().exportTypeButton,onClick:e=>E(N.EXPORT_TYPE.SHEET),children:[(0,n.jsx)("img",{src:k===N.EXPORT_TYPE.SHEET?"/Images/sheet_icon_selected.png":"/Images/sheet_icon.png",alt:"word"}),(0,n.jsx)("p",{children:"Sheet"})]}),(0,n.jsxs)("select",{name:"sheetExportFormat",onChange:e=>_(e.target.value),children:[(0,n.jsx)("option",{value:"excel",children:"EXCEL"}),(0,n.jsx)("option",{value:"csv",children:"CSV"})]})]})]}),(0,n.jsx)("div",{className:v().exportButton,children:(0,n.jsxs)("button",{className:"convert-button",onClick:()=>{(0,S.$)("Action_DownloadPressed");let e=K(),a=(0,h.Rq)(R,U,F,void 0,$.length,d.ne.FORMS);if(a===d.XQ.STATUS_OK){let a=Object.values(e).reduce((e,t)=>[...e,Object.values(t.result).reduce((e,t)=>[...e,t],[])],[]);N.formExportFile(t.lak,a,k,D,M,P).then(e=>{if(!e){B.error("Error exporting file");return}F===m.iv?(0,u.MZ)(P,X,$.length,$[0],k,"FORMS"):(0,u.Hd)(U.profile.id,X,$.length,$[0],k)}).catch(e=>{console.error(e),B.error("Error exporting file")}),(0,S.$)("State_ExportingForm");let n=k===N.EXPORT_TYPE.DOCUMENT?D:M;(0,S.$)("State_Export",{App:"Form",Type:k,Format:n,Pages:$.length,signedIn:F}),"CLIPBOARD"===D.toUpperCase()?B.info("Text copied to clipboard"):B.info("Downloading")}else a===d.XQ.STATUS_SUBSCRIPTION_REACHED_LIMIT?((0,S.$)("State_SubscriptionReachedLimit"),w.$Q(q,(0,n.jsxs)("p",{children:["Not enough pages left on your account. ",(0,n.jsx)("br",{}),"Upgrade your plan or wait for next month for additional credits."]}),"Upgrade Now",()=>{V.push(c.bP,void 0,{shallow:!0})})):a===d.XQ.STATUS_SERVICE_NOT_INCLUDED?((0,S.$)("State_ServiceNotIncluded"),w.$Q(q,(0,n.jsxs)("p",{children:["The tool you're trying to use is not included in your current plan. ",(0,n.jsx)("br",{}),"Consider upgrading your plan to access this tool."]}),"Upgrade Now",()=>{V.push(c.bP,void 0,{shallow:!0})})):((0,S.$)("State_NoCredit"),w.$Q(q,(0,n.jsxs)("p",{children:["Not enough pages left on your account. ",(0,n.jsx)("br",{}),"Get a plan for additional credits."]}),"Learn More",()=>{V.push(c.bP,void 0,{shallow:!0})}))},children:["Download",(0,n.jsx)("img",{className:"download-now-icon",src:"/Images/download_icon.png",alt:"download now"})]})})]})})}),l>1?(0,n.jsxs)("div",{className:"page-navigation",children:[(0,n.jsx)("div",{className:"scanline-arrow",onClick:()=>{r>=1&&G(r-1)},children:r>=1?(0,n.jsx)("img",{src:"/Images/arrow_back_blue.png",alt:"previous page"}):(0,n.jsx)("img",{src:"/Images/arrow_back_gray.png",alt:"no previous page"})}),(0,n.jsxs)("div",{className:"page-counter",children:["Page ",r+1,"/",l]}),(0,n.jsx)("div",{className:"scanline-arrow",onClick:()=>{r<l-1&&G(r+1)},children:r<l-1?(0,n.jsx)("img",{src:"/Images/arrow_next_blue.png",alt:"next page"}):(0,n.jsx)("img",{src:"/Images/arrow_next_gray.png",alt:"no next page"})})]}):(0,n.jsx)(n.Fragment,{}),H&&a&&(0,n.jsx)(Q,{ref:L,pageSize:W,setPageSize:z,templateMode:!1,tableModel:p,setTableModel:x,annotationModel:C,setAnnotationModel:y,imageContent:T.content,image:T,multiPage:l>1})]})};a(10246);let q=function(e){let t=(0,o.wA)(),[a,l]=(0,s.useState)({}),p=(0,o.d4)(e=>{var t,a;return null==e?void 0:null===(a=e.application)||void 0===a?void 0:null===(t=a.forms)||void 0===t?void 0:t.sessionStatus}),x=(0,o.d4)(e=>{var t,a,n,s;return null==e?void 0:null===(s=e.application)||void 0===s?void 0:null===(n=s.profile)||void 0===n?void 0:null===(a=n.profile)||void 0===a?void 0:null===(t=a.forms)||void 0===t?void 0:t.templatesList}),j=(0,o.d4)(e=>{var t,a;return null==e?void 0:null===(a=e.application)||void 0===a?void 0:null===(t=a.forms)||void 0===t?void 0:t.templatesList}),w=x||j||{},{profile:y,signedIn:b,user:T,fingerPrintProfile:I,storage:N}=(0,s.useContext)(u.t0),[k,D]=(0,s.useState)("-"),[A,M]=(0,s.useState)({}),_=(0,o.d4)(e=>{var t,a;return null==e?void 0:null===(a=e.application)||void 0===a?void 0:null===(t=a.forms)||void 0===t?void 0:t.activeTemplate}),R=(0,f.useRouter)();(0,s.useEffect)(()=>{(0,S.$)("View_FormsMainWindow")},[]),(0,s.useEffect)(()=>{D(h.RH(y))},[b,y,I]),(0,s.useEffect)(()=>{N&&w&&Object.keys(w).forEach(e=>{if(!(e in A)){var t,a;if(null===(a=w[e])||void 0===a?void 0:null===(t=a.image)||void 0===t?void 0:t.uid){let t=w[e].image.uid||"",a=(0,g.KR)(N,"templateImages/"+t);(0,g.qk)(a).then(t=>{M(a=>({...a,[e]:t}))}).catch(e=>{console.error("FormsMainWindow::useEffect::getDownloadURL::error::".concat(e))})}}})},[w]),(0,s.useEffect)(()=>{if(_&&!(_.scanId in A)){var e;if(null==_?void 0:null===(e=_.image)||void 0===e?void 0:e.uid){let e=_.image.uid,t=(0,g.KR)(N,"templateImages/"+e);(0,g.qk)(t).then(e=>{M(t=>({...t,[_.scanId]:e}))}).catch(e=>{console.error("FormsMainWindow::useEffect::ActiveTemplate::error::".concat(e))})}}},[_]),(0,s.useEffect)(()=>{p||t((0,i.jQ)(d.d3)),R.pathname===c.yY||R.pathname+"/"===c.yY?t((0,i.jQ)(d.d3)):R.pathname===c.Uj||(R.pathname===c.IS||R.pathname+"/"===c.IS)&&t((0,i.jQ)(d.ph))},[R.pathname]);let F=(0,n.jsx)("div",{className:"sign-up-message",children:(0,n.jsxs)("p",{children:["Convert and download the first ",d.RT," pages for free!"]})}),P=(0,n.jsx)("div",{className:"sign-up-message",children:(0,n.jsxs)("p",{children:["Only ",k," pages left, for more pages",(0,n.jsx)(r(),{href:c.bP,children:(0,n.jsx)("button",{className:"cursorActive",children:"Get a plan now"})})]})}),O=(0,n.jsx)("div",{className:"sign-up-message",children:(0,n.jsxs)("p",{children:["No pages left, for more pages",(0,n.jsx)(r(),{href:c.bP,children:(0,n.jsx)("button",{className:"cursorActive",children:"Get a plan now"})})]})}),U=p===d.d3?(0,n.jsx)(C,{imageTemplateUrlObj:A,...e}):p===d.iG?(0,n.jsx)(E,{imageTemplateUrlObj:A,setImageTemplateUrlObj:M,...e}):p===d.OW?(0,n.jsx)(H,{imageTemplateUrlObj:A,setImageTemplateUrlObj:M,...e}):p===d.ph?(0,n.jsx)(V,{activeScans:a,setActiveScans:l,...e}):p===d.QF?(0,n.jsx)($,{activeScans:a,setActiveScans:l,...e}):(0,n.jsx)(n.Fragment,{});return(0,n.jsxs)("div",{className:"MainWindow",children:[b===m.eS?k==d.RT?F:k<=0?O:!1===isNaN(k)?P:(0,n.jsx)(n.Fragment,{}):b===m.iv?k<=0?O:k<=d.RT?P:(0,n.jsx)(n.Fragment,{}):console.log("Login undef")&&(0,n.jsx)(n.Fragment,{}),U,(0,n.jsxs)("div",{className:v().buttonArea,children:[(0,n.jsx)("button",{className:v().formHelpButton,onClick:()=>{R.push(c.T2)},children:"?"}),(p===d.OW||p===d.QF)&&(0,n.jsx)("button",{className:v().startNewFormButton,onClick:()=>{t((0,i.jQ)(d.d3)),R.push(c.yY,void 0,{shallow:!0})},children:(0,n.jsx)("img",{src:"/Images/start_new.png",alt:"start new"})})]})]})}},27070:(e,t,a)=>{"use strict";a.r(t),a.d(t,{sendScanForAnalyze:()=>l,sendTemplateForAnalyze:()=>h,splitPdfAndAnalyze:()=>r});var n=a(42501);let{PDFDocument:s,rgb:o,utf8Encode:i}=a(64772);async function l(e,t,a,n,s){return d(e,t,a,"https://nmwe4beyw1.execute-api.us-east-1.amazonaws.com/dev/forms/AnalyzeForm",n,s,e=>[e])}async function r(e,t,a,n,s){return c(e,t,a,"https://nmwe4beyw1.execute-api.us-east-1.amazonaws.com/dev/forms/AnalyzeFormPdf",n,s,e=>[e])}async function c(e,t,a,n,o,i,l){return console.log("SplitPdf start"),new Promise(async(r,c)=>{let h=await s.load(t);console.log("Got pdf doc",h);let u=h.getPages();if(console.log("Total ".concat(u.length," PDF pages")),u.length>50){c(Error("pageCountExceeded"));return}var m=Array(u.length),g=0;for(let t=0;t<u.length;t++)s.create().then(s=>{s.copyPages(h,[t]).then(h=>{let[p]=h,v=p.getHeight(),f=p.getWidth();s.addPage(p),s.saveAsBase64({dataUri:!0}).then(s=>{console.log("pdfBase64 size",s.length),d(e,s,a,n,o,"".concat(i,"_pg").concat(t),l).then(e=>{let a=e[0];a.width=f,a.height=v,console.log("Got page ".concat(t," regognized with response")),m.splice(t,1,a),(g+=1)===u.length?(console.log("Resolving"),r(m)):console.log("result array not ready:".concat(g,",").concat(u.length))}).catch(e=>{console.error("Send file returned with error",e),c(e)})})})})})}async function d(e,t,a,s,o,i,l){return new Promise(async(o,i)=>{let r=t.slice(t.indexOf(",")),c=await (0,n.Y)(t);var d={method:"POST",body:JSON.stringify({srcImg:r,model:a.model,srcHash:c}),headers:{"Content-Type":"application/json","X-Api-Key":e}};console.log("Request launched:scanFile",s),fetch(s,d).then(e=>{console.log("Request completed"),200!==e.status&&(console.log("Looks like there was a problem. Status Code: "+e.status),console.log("Response:"+e.message),i({message:"Communication error"})),e.json().then(e=>{1!==parseInt(e.status)?(console.log("Error message:"+e.message),console.log("Log:"+e.log),console.log("Error:"+e.trace),i({message:e.message})):o(l({result:e.result,scale:e.scale,imgContent:e.imgContent}))})}).catch(e=>{console.log("Fetch Error :-S",e),i(e)})})}async function h(e,t,a,s){return new Promise(async(a,s)=>{var o={method:"POST",body:JSON.stringify({srcImg:t.slice(t.indexOf(",")),srcHash:await (0,n.Y)(t)}),headers:{"Content-Type":"application/json","X-Api-Key":e}};console.log("Request launched:scanTemplate"),fetch("https://nmwe4beyw1.execute-api.us-east-1.amazonaws.com/dev/forms/scanTemplate",o).then(e=>{console.log("Request completed"),200!==e.status&&(console.log("Looks like there was a problem. Status Code: "+e.status),console.log("Response:"+e.message),s({message:"Communication error"})),e.json().then(e=>{1!==parseInt(e.status)?(console.log("Error message:"+e.error),console.log("Log:"+e.log),console.log("Error:"+e.error),s({message:e.error})):a(e.result)})}).catch(e=>{console.log("Fetch Error :-S",e),s(e)})})}},23839:e=>{e.exports={rpStage:"pictureAnnotation_rpStage__M9CSe",rpImage:"pictureAnnotation_rpImage__YxChR",rpShapes:"pictureAnnotation_rpShapes__R2e0j",rpSelectedInput:"pictureAnnotation_rpSelectedInput__07UyZ",rpDelete:"pictureAnnotation_rpDelete__e42N3",rpDeleteSection:"pictureAnnotation_rpDeleteSection__STDH_",rpDefaultInputSection:"pictureAnnotation_rpDefaultInputSection__8RKCI"}}}]);